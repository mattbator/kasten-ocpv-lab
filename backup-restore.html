<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Protecting VMs | Veeam Kasten Lab Guide - OpenShift Virtualization Roadshow</title>
    <meta name="description" content="Add-on lab exercises for enterprise-ready Kubernetes data protection">
    <meta name="generator" content="VitePress v1.1.4">
    <link rel="preload stylesheet" href="/kasten-ocpv-lab/assets/style.nHKUAIsF.css" as="style">
    
    <script type="module" src="/kasten-ocpv-lab/assets/app.DJYNw9ma.js"></script>
    <link rel="preload" href="/kasten-ocpv-lab/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/kasten-ocpv-lab/assets/chunks/theme.Q6guWuno.js">
    <link rel="modulepreload" href="/kasten-ocpv-lab/assets/chunks/framework.DZXLJAMc.js">
    <link rel="modulepreload" href="/kasten-ocpv-lab/assets/backup-restore.md.BVTVk4yY.lean.js">
    <link rel="icon" href="./favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-c4daae71><!--[--><!--]--><!--[--><span tabindex="-1" data-v-b22defb4></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-b22defb4> Skip to content </a><!--]--><!----><header class="VPNav" data-v-c4daae71 data-v-a46e73f0><div class="VPNavBar has-sidebar top" data-v-a46e73f0 data-v-48384a78><div class="wrapper" data-v-48384a78><div class="container" data-v-48384a78><div class="title" data-v-48384a78><div class="VPNavBarTitle has-sidebar" data-v-48384a78 data-v-dbe614b8><a class="title" href="/kasten-ocpv-lab/" data-v-dbe614b8><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/kasten-ocpv-lab/logo-dark.svg" alt data-v-4d414b82><!--]--><!--[--><img class="VPImage light logo" src="/kasten-ocpv-lab/logo.svg" alt data-v-4d414b82><!--]--><!--]--><!--]--><!----><!--[--><!--]--></a></div></div><div class="content" data-v-48384a78><div class="content-body" data-v-48384a78><!--[--><!--]--><div class="VPNavBarSearch search" data-v-48384a78><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-48384a78 data-v-c6c3e6d4><span id="main-nav-aria-label" class="visually-hidden" data-v-c6c3e6d4>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/kasten-ocpv-lab/" tabindex="0" data-v-c6c3e6d4 data-v-2b93b872><!--[--><span data-v-2b93b872>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/kasten-ocpv-lab/install" tabindex="0" data-v-c6c3e6d4 data-v-2b93b872><!--[--><span data-v-2b93b872>Lab Guide</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-c6c3e6d4 data-v-8fd20e7d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8fd20e7d><span class="text" data-v-8fd20e7d><!----><span data-v-8fd20e7d>Resources</span><span class="vpi-chevron-down text-icon" data-v-8fd20e7d></span></span></button><div class="menu" data-v-8fd20e7d><div class="VPMenu" data-v-8fd20e7d data-v-7bffa9cd><div class="items" data-v-7bffa9cd><!--[--><!--[--><div class="VPMenuLink" data-v-7bffa9cd data-v-71c5411b><a class="VPLink link vp-external-link-icon" href="https://docs.kasten.io" target="_blank" rel="noreferrer" data-v-71c5411b><!--[-->Kasten Docs<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7bffa9cd data-v-71c5411b><a class="VPLink link vp-external-link-icon" href="https://kastenhq.github.io/k10-openshift-lab.github.io/" target="_blank" rel="noreferrer" data-v-71c5411b><!--[-->Kasten Intro Lab (demo.redhat.com)<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7bffa9cd data-v-71c5411b><a class="VPLink link vp-external-link-icon" href="https://veeamkasten.dev/demo-ocp" target="_blank" rel="noreferrer" data-v-71c5411b><!--[-->Interactive Tour - Kasten + OCP<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-7bffa9cd data-v-71c5411b><a class="VPLink link vp-external-link-icon" href="https://veeamkasten.dev/ocpv-kasten-demo " target="_blank" rel="noreferrer" data-v-71c5411b><!--[-->Clickable Tour - Kasten + OCP-V<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-48384a78 data-v-f774fc1d><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-f774fc1d data-v-bfa23729 data-v-7012e5dd><span class="check" data-v-7012e5dd><span class="icon" data-v-7012e5dd><!--[--><span class="vpi-sun sun" data-v-bfa23729></span><span class="vpi-moon moon" data-v-bfa23729></span><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-48384a78 data-v-ca99dad5 data-v-8fd20e7d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8fd20e7d><span class="vpi-more-horizontal icon" data-v-8fd20e7d></span></button><div class="menu" data-v-8fd20e7d><div class="VPMenu" data-v-8fd20e7d data-v-7bffa9cd><!----><!--[--><!--[--><!----><div class="group" data-v-ca99dad5><div class="item appearance" data-v-ca99dad5><p class="label" data-v-ca99dad5>Appearance</p><div class="appearance-action" data-v-ca99dad5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-ca99dad5 data-v-bfa23729 data-v-7012e5dd><span class="check" data-v-7012e5dd><span class="icon" data-v-7012e5dd><!--[--><span class="vpi-sun sun" data-v-bfa23729></span><span class="vpi-moon moon" data-v-bfa23729></span><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-48384a78 data-v-670493dd><span class="container" data-v-670493dd><span class="top" data-v-670493dd></span><span class="middle" data-v-670493dd></span><span class="bottom" data-v-670493dd></span></span></button></div></div></div></div><div class="divider" data-v-48384a78><div class="divider-line" data-v-48384a78></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-c4daae71 data-v-9d8129cc><div class="container" data-v-9d8129cc><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-9d8129cc><span class="vpi-align-left menu-icon" data-v-9d8129cc></span><span class="menu-text" data-v-9d8129cc>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-9d8129cc data-v-d1de893e><button data-v-d1de893e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-c4daae71 data-v-2667f5e2><div class="curtain" data-v-2667f5e2></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-2667f5e2><span class="visually-hidden" id="sidebar-aria-label" data-v-2667f5e2> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-2667f5e2><section class="VPSidebarItem level-0 has-active" data-v-2667f5e2 data-v-f2cc49b6><div class="item" role="button" tabindex="0" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><h2 class="text" data-v-f2cc49b6>Lab Guide</h2><!----></div><div class="items" data-v-f2cc49b6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/install" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Installing Veeam Kasten</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/location-profile" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Creating Location Profiles</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/k10dr" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Enabling K10DR</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/backup-restore" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Protecting Virtual Machines</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-2667f5e2><section class="VPSidebarItem level-0" data-v-2667f5e2 data-v-f2cc49b6><div class="item" role="button" tabindex="0" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><h2 class="text" data-v-f2cc49b6>Optional</h2><!----></div><div class="items" data-v-f2cc49b6><!--[--><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/multicluster" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Configuring Multi-Cluster</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-f2cc49b6 data-v-f2cc49b6><div class="item" data-v-f2cc49b6><div class="indicator" data-v-f2cc49b6></div><a class="VPLink link link" href="/kasten-ocpv-lab/mobility" data-v-f2cc49b6><!--[--><p class="text" data-v-f2cc49b6>Migrating Workloads</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-c4daae71 data-v-d2aef184><div class="VPDoc has-sidebar has-aside" data-v-d2aef184 data-v-ef3a4dda><!--[--><!--]--><div class="container" data-v-ef3a4dda><div class="aside" data-v-ef3a4dda><div class="aside-curtain" data-v-ef3a4dda></div><div class="aside-container" data-v-ef3a4dda><div class="aside-content" data-v-ef3a4dda><div class="VPDocAside" data-v-ef3a4dda data-v-79cae1a0><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-79cae1a0 data-v-5e48b989><div class="content" data-v-5e48b989><div class="outline-marker" data-v-5e48b989></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-5e48b989>On this page</div><ul class="VPDocOutlineItem root" data-v-5e48b989 data-v-da421f78><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-79cae1a0></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-ef3a4dda><div class="content-container" data-v-ef3a4dda><!--[--><!--]--><main class="main" data-v-ef3a4dda><div style="position:relative;" class="vp-doc _kasten-ocpv-lab_backup-restore" data-v-ef3a4dda><div><h1 id="protecting-vms" tabindex="-1">Protecting VMs <a class="header-anchor" href="#protecting-vms" aria-label="Permalink to &quot;Protecting VMs&quot;">​</a></h1><h2 id="_1-introduction" tabindex="-1">1. Introduction <a class="header-anchor" href="#_1-introduction" aria-label="Permalink to &quot;1. Introduction&quot;">​</a></h2><p><em>In this exercise you will create and run a Kasten policy for protecting Virtual Machines running on OpenShift and test restoring from both local and remote backup sources.</em></p><h2 id="_2-creating-a-vm" tabindex="-1">2. Creating a VM <a class="header-anchor" href="#_2-creating-a-vm" aria-label="Permalink to &quot;2. Creating a VM&quot;">​</a></h2><p>Fist you will create a new VM in a new project to use for the exercise.</p><ol><li><p>In the <em><strong>OpenShift Console</strong></em>, select the <em><strong>Project</strong></em> menu and click <em><strong>Create Project</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/01.CNIjeHVS.png" alt=""></p></li><li><p>Specify <code>kasten-lab</code> as the <em><strong>Name</strong></em> and click <em><strong>Create</strong></em>.</p></li><li><p>Select <em><strong>Virtualization → Virtual Machines</strong></em> from the sidebar, and click <em><strong>Create VirtualMachine</strong></em> in the <code>kasten-lab</code> Project.</p><p><img src="/kasten-ocpv-lab/assets/03.BontXkkM.png" alt=""></p></li><li><p>Under <em><strong>Template catalog</strong></em>, select the <code>fedora-server-small</code> template.</p><p><img src="/kasten-ocpv-lab/assets/04.fnTspvcu.png" alt=""></p></li><li><p>Update the <em><strong>VirtualMachine name</strong></em> to <code>fedora-k10</code> and click <em><strong>Quick create VirtualMachine</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/05.DCNl8Y6n.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>This will provision the VM with preferred storage settings for the default <code>ocs-storagecluster-ceph-rbd</code> StorageClass, specifically <em><strong>Block VolumeMode</strong></em> to provide the <em><strong>ReadWriteMany</strong></em> access required to enable live migration.</p></div></li><li><p>Validate the <code>fedora-k10</code> PersistentVolumeClaim configuration from <em><strong>Storage → PersistentVolumeClaims</strong></em> in the sidebar.</p><p><img src="/kasten-ocpv-lab/assets/06.BK0d08UF.png" alt=""></p></li></ol><h2 id="_3-enabling-block-mode-exports" tabindex="-1">3. Enabling Block Mode Exports <a class="header-anchor" href="#_3-enabling-block-mode-exports" aria-label="Permalink to &quot;3. Enabling Block Mode Exports&quot;">​</a></h2><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>As some storage provisioners may not fully support Block volume mode, StorageClasses should first be evaluated for compatibility <a href="https://docs.kasten.io/latest/operating/k10tools.html#k10-primer-block-mount-check" target="_blank" rel="noreferrer">using the primer script</a>. This is skipped in the lab exercise as the <code>openshift-storage.rbd.csi.ceph.com</code> provisioner is known to be compatible.</p></div><ol><li><p>In the <em><strong>Web Terminal</strong></em>, run the following to allow the Kasten datamover to export raw Block volumes using the <code>ocs-storagecluster-ceph-rbd</code> StorageClass:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> storageclass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ocs-storagecluster-ceph-rbd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  k10.kasten.io/sc-supports-block-mode-exports=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><p>By default, Kasten provides an out-of-the-box, direct API integration with ODF&#39;s Ceph Volume Manager for block data movement - including support for incremental backups to lower storage consumption requirements for protecting Virtual Machines.</p><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p>While many Kubernetes backup solutions can orchestrate local CSI snapshots of a <code>volumeMode: Block</code> PVC, it is important to remember that <em>snapshots do not equal backup</em> - and that having a backup solution that can provide off-cluster data movement for <code>volumeMode: Block</code> PVCs is critical. Support for this capability does <strong>NOT</strong> exist in Velero or OADP today.</p></div></li></ol><h2 id="_4-creating-a-kasten-policy" tabindex="-1">4. Creating a Kasten Policy <a class="header-anchor" href="#_4-creating-a-kasten-policy" aria-label="Permalink to &quot;4. Creating a Kasten Policy&quot;">​</a></h2><ol><li><p>In the <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Applications</strong></em> to view all discovered namespaces.</p><p><img src="/kasten-ocpv-lab/assets/07.CaHTUF-x.png" alt=""></p><p>Your <code>kasten-lab</code> application should appear as <em><strong>Unmanaged</strong></em>, indicating it is not being protected by any policy.</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><p>Namespaces, including the <code>openshift-...</code> system namespaces can be excluded from the <em><strong>Applications</strong></em> list (and compliance reporting) by adding a list of <code>excludedApps</code> to the K10 Operand <code>spec</code>, as shown:</p><p><img src="/kasten-ocpv-lab/assets/08.BavMi1sj.png" alt=""></p><p>The following command can be used to produce a properly formatted list of namespaces beginning with <code>openshift</code> that can be copy/paste into the K10 Operand YAML tab:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ns</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-headers=true</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> awk</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;BEGIN { print &quot;  excludedApps:&quot; } /^openshift/{print &quot;    -&quot;,$1}&#39;</span></span></code></pre></div></div></li><li><p>Click <code>kasten-lab</code> in the <em><strong>Applications</strong></em> list to view details about the workloads and additional resources discovered within the namespace.</p><p><img src="/kasten-ocpv-lab/assets/09.l7wvJ9DL.png" alt=""></p></li><li><p>Close the <em><strong>Application Details</strong></em> window.</p></li><li><p>Under <code>kasten-lab</code>, select <em><strong>... → Create a Policy</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/10.C72cfKD3.png" alt=""></p></li><li><p>Leave the default <em><strong>Name</strong></em> and <em><strong>Action</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/11.DXijJHcz.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Policy Presets provide the option of allowing administrators to define SLA-focused configurations to simplify self-service data protection for other users.</p></div></li><li><p>Leave the default <em><strong>Hourly Backup Frequency</strong></em> and <em><strong>Snapshot Retention</strong></em> values.</p><p><img src="/kasten-ocpv-lab/assets/12.D65y05Bk.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Toggling <em><strong>Advanced Frequency Options</strong></em> allows users to specify what time hourly snapshots occur, how many snapshots to take per hour, and which snapshots should be used for daily, weekly, monthly, and yearly promotion.</p><p>Toggling <em><strong>Backup Window</strong></em> allows users to specify during what times is Kasten allowed to run the policy. Enabling <em><strong>Use Staggering</strong></em> can intelligently distribute when to start policies during the specified window such that the desired frequency is maintained, but with the least amount of policies running simultaneously, allowing Kasten to reduce the peak load on the cluster.</p><p>These settings should be left unselected for this lab.</p></div></li><li><p>Toggle <em><strong>Enable Backups via Snapshot Exports</strong></em> and select <code>ceph-rgw-immutable</code> as the <em><strong>Export Location Profile</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/13.BnrOxv-E.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>By default, Kasten will export all data associated with the snapshot to ensure you have a durable, off-cluster copy. However, there are circumstances where you may only want to export references to the snapshot, such as migrating a workload in AWS from one availability zone to another. This ability to only export snapshot metadata can dramatically improve performance in these specific instances. This can be configured under <em><strong>Advanced Export Settings</strong></em>.</p></div></li><li><p>Under <em><strong>Select Applications</strong></em>, verify the <code>kasten-lab</code> namespace has been selected.</p><p><img src="/kasten-ocpv-lab/assets/14.BNMEnAug.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Targeting application(s) based on namespace is generally the most straightforward method of defining a backup policy. However, Kasten also allows you to identify applications based on native Kubernetes labels. This is especially helpful if you want to define &quot;blanket&quot; policies that will apply to current and <em><strong>future</strong></em> applications, such as <code>hasData: true</code> or <code>backup: gold</code>.</p><p>Kasten also provides rich filtering capabilities to include or exclude resources based on Kubernetes <em><strong>API Group</strong></em>, <em><strong>API Version</strong></em>, <em><strong>Resource Type</strong></em>, <em><strong>Resource Name</strong></em>, and <em><strong>Labels</strong></em>. For example, you could exclude backup for <em><strong>Secrets</strong></em> resources where a label includes an indication that the secret is externally managed.</p></div></li><li><p>Leave the remaining settings as default.</p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><p>When performing many tasks within the Kasten UI, you can press the <em><strong>&lt;/&gt; YAML</strong></em> button to expose the native Kubernetes YAML that defines the resource created through the UI. This can be useful for familiarizing yourself with the Kubernetes-native APIs defined by Kasten and for extracting snippets for use in GitOps or Infrastructure-as-Code tools.</p></div></li><li><p>Click <em><strong>Create Policy</strong></em>.</p></li></ol><h2 id="_5-freezing-the-guest-filesystem" tabindex="-1">5. Freezing the Guest Filesystem <a class="header-anchor" href="#_5-freezing-the-guest-filesystem" aria-label="Permalink to &quot;5. Freezing the Guest Filesystem&quot;">​</a></h2><p>Kasten can freeze the guest filesystem before the snapshot and unfreeze after the snapshot completes by annotating the VirtualMachine resource with <code>k10.kasten.io/freezeVM=true</code>.</p><ol><li><p>In the <em><strong>Web Terminal</strong></em>, enable filesystem freezing for <code>fedora-k10</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> annotate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> virtualmachine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fedora-k10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-lab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  k10.kasten.io/freezeVM=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span></code></pre></div><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>The freeze and unfreeze operations will only be attempted if the VirtualMachine is in <em><strong>Running</strong></em> state.</p></div><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p></p><p>Kasten defines a 5 minute default timeout for the snapshot operation to complete before aborting the snapshot operation and unfreezing the VM. This can be overridden using the <code>kubeVirtVMs.snapshot.unfreezeTimeout</code> Helm/Operand parameter.</p></div></li></ol><h2 id="_6-running-the-policy" tabindex="-1">6. Running the Policy <a class="header-anchor" href="#_6-running-the-policy" aria-label="Permalink to &quot;6. Running the Policy&quot;">​</a></h2><p>Rather than wait until the top of the hour for the policy to run, you can manually initiate a policy run programmatically or via the UI.</p><ol><li><p>In <em><strong>Kasten Dashboard → Policies → Policies</strong></em>, click <em><strong>Run Once</strong></em> for the <code>kasten-lab-backup</code> Policy.</p><p><img src="/kasten-ocpv-lab/assets/15.C18m0pDs.png" alt=""></p></li><li><p>Optionally, specify an expiration date for the manual backup and then click <em><strong>Yes, Continue</strong></em> to start the backup.</p><p><img src="/kasten-ocpv-lab/assets/16.C6oo3uFJ.png" alt=""></p></li><li><p>Select <em><strong>Dashboard</strong></em> from the sidebar.</p></li><li><p>Under <em><strong>Actions</strong></em>, select the <code>kasten-lab-backup</code> Policy Run to monitor status.</p><p><img src="/kasten-ocpv-lab/assets/17.D7EkATdA.png" alt=""></p><p>Click into each individual <em><strong>Action</strong></em> to view to associated details, including YAML, a complete list of the application metadata and volume snapshots protected, and how much volume data was transferred by the Kasten datamover to the Location Profile.</p><p><img src="/kasten-ocpv-lab/assets/18.BunpovEK.png" alt=""></p></li><li><p>Wait for the <em><strong>Policy Run</strong></em> to complete before proceeding.</p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p></p><p>If your policy fails, review the provided error message for further details. <em>Did you miss annotating the storage class to allow block exports above?</em></p></div></li></ol><h2 id="_7-performing-a-local-restore" tabindex="-1">7. Performing a Local Restore <a class="header-anchor" href="#_7-performing-a-local-restore" aria-label="Permalink to &quot;7. Performing a Local Restore&quot;">​</a></h2><p>When performing an in-place restore on the application&#39;s original cluster, choosing the local RestorePoint provides the most rapid recovery as it uses the snapshot data already present on primary storage, rather than having to depend on data which must be transferred from the remote repository.</p><ol><li><p>In the <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Applications</strong></em> from the sidebar.</p><p>You should observe that the <code>kasten-lab</code> <em><strong>Status</strong></em> has changed to <em><strong>Compliant</strong></em>, indicating that the application is compliant with the backup SLA defined in the policy (i.e. There is a backup for the application created within the last hour to satisfy the hourly policy frequency).</p></li><li><p>Under <code>kasten-lab</code>, select <em><strong>... → Restore</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/19.W3WidbtZ.png" alt=""></p></li><li><p>Select the most recent RestorePoint, and click the local version as shown below.</p><p><img src="/kasten-ocpv-lab/assets/20.1Zf5CRhj.png" alt=""></p><p>You should observe by default the selected RestorePoint includes all resources captured as part of the backup will be restored to its original namespace - with options to perform a more granular restore and/or modify the target namespace.</p></li><li><p>Keep the default settings and click <em><strong>Restore</strong></em> to begin a full, in-place restore.</p><p><img src="/kasten-ocpv-lab/assets/21.EsKTIC2G.png" alt=""></p><div class="warning custom-block github-alert"><p class="custom-block-title">WARNING</p><p></p><p>Kasten will terminate the running VM and overwrite the existing resources. However, any resources in the namespace that do not exist in the RestorePoint will not be altered (protecting against unintentional data loss).</p></div></li><li><p>Return to the <em><strong>Dashboard</strong></em> to monitor the status of the <em><strong>Restore</strong></em> under <em><strong>Actions</strong></em>.</p><p>You should expect this operation to complete rapidly, as the VM volume is being restored from a local CSI VolumeSnapshot.</p></li><li><p>Once the <em><strong>Restore</strong></em> has completed, return to <em><strong>OpenShift Console → Virtualization → Virtual Machines</strong></em> and validate the <code>fedora-k10</code> VM is <em><strong>Running</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/22.COG-Pv-c.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>You can also validate the source of the restored volume by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fedora-k10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-lab</span></span></code></pre></div><p>You should observe the volume&#39;s <em><strong>DataSource</strong></em> is a <code>k10-csi-snap-...</code> VolumeSnapshot.</p></div></li></ol><h2 id="_8-performing-a-remote-restore" tabindex="-1">8. Performing a Remote Restore <a class="header-anchor" href="#_8-performing-a-remote-restore" aria-label="Permalink to &quot;8. Performing a Remote Restore&quot;">​</a></h2><p>Often local snapshot data may not be available, requiring that data be restored from the remote Kasten repository.</p><ol><li><p>In the <em><strong>Web Terminal</strong></em>, run the following to delete the <code>kasten-lab</code> namespace:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> virtualmachine</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fedora-k10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-lab</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> delete</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> namespace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-lab</span></span></code></pre></div><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p><em>&quot;Snapshots are not backup.&quot;</em> ~ Mark Twain</p><p>VolumeSnapshots are namespaced resources. Removing the <code>kasten-lab</code> namespace will delete the VolumeSnapshots associated with your local RestorePoints. Additionally, the <code>ocs-storagecluster-rbdplugin-snapclass</code> VolumeSnapshotClass sets <code>deletionPolicy: Delete</code> by default, meaning that deletion of the VolumeSnapshot resource results in the removal of the snapshot within Ceph.</p></div></li><li><p>In the <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Applications</strong></em> from the sidebar.</p></li><li><p>Click the <em><strong>All</strong></em> dropdown menu and select <em><strong>Removed</strong></em> to view the list of non-existent namespaces with available RestorePoints.</p><p><img src="/kasten-ocpv-lab/assets/23.Ok62OGlY.png" alt=""></p></li><li><p>Under <code>kasten-lab</code>, select <em><strong>... → Restore</strong></em>.</p></li><li><p>Select the most recent RestorePoint, and click the <em><strong>EXPORTED</strong></em> version as shown below.</p><p><img src="/kasten-ocpv-lab/assets/24.Bdnzsx0o.png" alt=""></p></li><li><p>Under <em><strong>Application Name</strong></em>, click <em><strong>+ Create New Namespace</strong></em>.</p></li><li><p>Specify <code>kasten-lab-clone</code> as the <em><strong>New Namespace</strong></em> and click <em><strong>Create</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/25.BQrrHbu4.png" alt=""></p></li><li><p>Click <em><strong>Restore</strong></em> and return to the <em><strong>Dashboard</strong></em> to monitor progress under <em><strong>Actions</strong></em>.</p><p><img src="/kasten-ocpv-lab/assets/26.BL6RlFdC.png" alt=""></p></li><li><p>Return to <em><strong>OpenShift Console → Virtualization → VirtualMachines</strong></em> and observe the <code>fedora-k10</code> VirtualMachine now running in the <code>kasten-lab-clone</code> namespace.</p><p><img src="/kasten-ocpv-lab/assets/27.PvXHkpna.png" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Unlike the local restore, the PVC populated by the Kasten datamover will not contain a <em><strong>DataSource</strong></em> snapshot reference:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pvc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> fedora-k10</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-lab-clone</span></span></code></pre></div></div></li></ol><h2 id="_9-takeaways" tabindex="-1">9. Takeaways <a class="header-anchor" href="#_9-takeaways" aria-label="Permalink to &quot;9. Takeaways&quot;">​</a></h2><p><em>Congratulations on having protected and restored your first workload using Veeam Kasten!</em> Below are some of the key takeaways of what has been covered in the lab so far:</p><ul><li>Kasten runs on the cluster and can be deployed via OperatorHub or Helm chart</li><li>Kasten supports multiple authentication options (Tokens, OIDC, LDAP, OpenShift OAuth) and Kubernetes-native RBAC for controlling access and providing per-namespace self-service</li><li>Kasten can backup data to S3, Azure Blob, Google Cloud Storage, NFS, and Veeam Backup &amp; Replication</li><li>Immutable backup support prevents unintended or malicious attempts to delete backup data, providing critical protection against ransomware</li><li><code>Block</code> mode volumes can provide <code>ReadWriteMany</code> access using Ceph RBD, the most performant option for enabling Live Migration of OpenShift Virtual Machines</li><li>Kasten performs always incremental backups with support for both <code>Filesystem</code> and <code>Block</code> mode volumes</li></ul></div></div></main><footer class="VPDocFooter" data-v-ef3a4dda data-v-0ce50de1><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-0ce50de1><span class="visually-hidden" id="doc-footer-aria-label" data-v-0ce50de1>Pager</span><div class="pager" data-v-0ce50de1><a class="VPLink link pager-link prev" href="/kasten-ocpv-lab/k10dr" data-v-0ce50de1><!--[--><span class="desc" data-v-0ce50de1>Previous page</span><span class="title" data-v-0ce50de1>Enabling K10DR</span><!--]--></a></div><div class="pager" data-v-0ce50de1><a class="VPLink link pager-link next" href="/kasten-ocpv-lab/multicluster" data-v-0ce50de1><!--[--><span class="desc" data-v-0ce50de1>Next page</span><span class="title" data-v-0ce50de1>Configuring Multi-Cluster</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-c4daae71 data-v-e3157d6d><div class="container" data-v-e3157d6d><!----><p class="copyright" data-v-e3157d6d>©2024 Veeam® Software</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"BxR63TF8\",\"multicluster.md\":\"BF6C0N15\",\"mobility.md\":\"Cb42uN4k\",\"install.md\":\"WZBS6iqE\",\"readme.md\":\"CUzXqjAF\",\"k10dr.md\":\"BJErikAP\",\"backup-restore.md\":\"BVTVk4yY\",\"location-profile.md\":\"D8aKWV2O\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Veeam Kasten Lab Guide - OpenShift Virtualization Roadshow\",\"description\":\"Add-on lab exercises for enterprise-ready Kubernetes data protection\",\"base\":\"/kasten-ocpv-lab/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"siteTitle\":false,\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Lab Guide\",\"link\":\"/install\"},{\"text\":\"Resources\",\"items\":[{\"text\":\"Kasten Docs\",\"link\":\"https://docs.kasten.io\"},{\"text\":\"Kasten Intro Lab (demo.redhat.com)\",\"link\":\"https://kastenhq.github.io/k10-openshift-lab.github.io/\"},{\"text\":\"Interactive Tour - Kasten + OCP\",\"link\":\"https://veeamkasten.dev/demo-ocp\"},{\"text\":\"Clickable Tour - Kasten + OCP-V\",\"link\":\"https://veeamkasten.dev/ocpv-kasten-demo \"}]}],\"logo\":{\"light\":\"/logo.svg\",\"dark\":\"/logo-dark.svg\"},\"sidebar\":[{\"text\":\"Lab Guide\",\"items\":[{\"text\":\"Installing Veeam Kasten\",\"link\":\"/install\"},{\"text\":\"Creating Location Profiles\",\"link\":\"/location-profile\"},{\"text\":\"Enabling K10DR\",\"link\":\"/k10dr\"},{\"text\":\"Protecting Virtual Machines\",\"link\":\"/backup-restore\"}]},{\"text\":\"Optional\",\"items\":[{\"text\":\"Configuring Multi-Cluster\",\"link\":\"/multicluster\"},{\"text\":\"Migrating Workloads\",\"link\":\"/mobility\"}]}],\"search\":{\"provider\":\"local\"},\"footer\":{\"copyright\":\"©2024 Veeam® Software\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":true}");</script>
    
  </body>
</html>