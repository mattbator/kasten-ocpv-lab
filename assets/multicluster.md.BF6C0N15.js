import{_ as e,c as s,o as t,a4 as i}from"./chunks/framework.DZXLJAMc.js";const a="/kasten-ocpv-lab/assets/01.CRhpS7u4.png",n="/kasten-ocpv-lab/assets/02.CY4qLAFF.png",o="/kasten-ocpv-lab/assets/03.DR2OLDPz.png",r="/kasten-ocpv-lab/assets/04.NoC_ydIx.png",l="/kasten-ocpv-lab/assets/05.DjDACvId.png",p="/kasten-ocpv-lab/assets/06.CNlYu532.png",c="/kasten-ocpv-lab/assets/07.CT6VvmHV.png",d="/kasten-ocpv-lab/assets/08.CHtUABgW.png",h="/kasten-ocpv-lab/assets/09.xIHoVHHm.png",g="/kasten-ocpv-lab/assets/10.9HApCl-O.png",u="/kasten-ocpv-lab/assets/11.RDpD6V43.png",m="/kasten-ocpv-lab/assets/12.8aQO_Gyq.png",k="/kasten-ocpv-lab/assets/13.n_xgnMgt.png",b="/kasten-ocpv-lab/assets/14.BNcUDO6v.png",y="/kasten-ocpv-lab/assets/15.C6OHbCly.png",C="/kasten-ocpv-lab/assets/16.CA1zuQlg.png",F="/kasten-ocpv-lab/assets/17.KITP7TkQ.png",D=JSON.parse('{"title":"Kasten Multi-Cluster","description":"","frontmatter":{},"headers":[],"relativePath":"multicluster.md","filePath":"multicluster.md"}'),f={name:"multicluster.md"},E=i('<h1 id="kasten-multi-cluster" tabindex="-1">Kasten Multi-Cluster <a class="header-anchor" href="#kasten-multi-cluster" aria-label="Permalink to &quot;Kasten Multi-Cluster&quot;">‚Äã</a></h1><h2 id="_1-introduction" tabindex="-1">1. Introduction <a class="header-anchor" href="#_1-introduction" aria-label="Permalink to &quot;1. Introduction&quot;">‚Äã</a></h2><p>Each Veeam Kasten deployment can function completely independent of other instances, without dependence on a separate customer-hosted or SaaS control plane - making it ideal for GitOps-style management and use in fully airgapped environments. However, Kasten also provides a user interface for providing consolidated observability and centralized management of globally configured Kasten resources - <em><strong>Kasten Multi-cluster Manager</strong></em>.</p><hr><p><em>In this exercise you will configure Kasten Multi-cluster Manager, join a second cluster, and distribute a centrally managed location profile to both clusters. As each learner only has a single cluster, you will need to work with a partner, designating (1) user/cluster as <code>cluster-1</code> and (1) user/cluster as <code>cluster-2</code>.</em></p><h2 id="_2-enable-feature-flag" tabindex="-1">2. Enable Feature Flag <a class="header-anchor" href="#_2-enable-feature-flag" aria-label="Permalink to &quot;2. Enable Feature Flag&quot;">‚Äã</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p>This section should be completed by <em><strong>BOTH</strong></em> the <code>cluster-1</code> user and <code>cluster-2</code> user.</p></div><ol><li><p>In the <em><strong>Web Terminal</strong></em>, run the following to resolve the Kasten Feature Flag URL for your cluster:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;https://$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get route k10-route </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> kasten-io </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.spec.host}&#39;)/k10/#/features&quot;</span></span></code></pre></div></li><li><p>Open the URL in your browser and enable <em><strong>Join from Secondary</strong></em> as shown.</p><p><img src="'+a+'" alt=""></p></li><li><p>When prompted, click <em><strong>Refresh</strong></em>.</p><p>This step has been performed to enable the updated UI for mutli-cluster which will become the standard interface in Veeam Kasten V7.0.</p></li></ol><h2 id="_3-configuring-primary-cluster" tabindex="-1">3. Configuring Primary Cluster <a class="header-anchor" href="#_3-configuring-primary-cluster" aria-label="Permalink to &quot;3. Configuring Primary Cluster&quot;">‚Äã</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p>This section should be completed by the <code>cluster-1</code> user <em><strong>ONLY</strong></em>.</p></div><p>The <em><strong>Primary</strong></em> cluster defines and stores all global resources, such as Policies and Profiles, and also <a href="https://docs.kasten.io/latest/operating/monitoring.html#k10-multi-cluster-metrics" target="_blank" rel="noreferrer">aggregates a subset of cluster metrics</a> for centralized reporting.</p><ol><li><p>In the <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Multi-Cluster</strong></em> from the sidebar.</p></li><li><p>Under <em><strong>Promote to Primary</strong></em>, click <em><strong>Setup</strong></em>.</p><p><img src="'+n+'" alt=""></p></li><li><p>Specify <code>cluster-1</code> as the <em><strong>Primary Name</strong></em> and click <em><strong>Setup ‚Üí Confirm</strong></em>.</p><p><img src="'+o+'" alt=""></p><p>After setup completes, you should see the <em><strong>Multi-cluster Manager</strong></em> view.</p><p><img src="'+r+'" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>A Kasten cluster can also be promoted to the primary cluster role declaratively using Helm/Operand parameters. See <a href="https://docs.kasten.io/latest/multicluster/tutorials/getting_started.html#setting-up-the-primary-cluster-using-helm" target="_blank" rel="noreferrer">docs.kasten.io</a> for details.</p></div></li><li><p>Select <em><strong>Join Tokens</strong></em> from the sidebar and click <em><strong>+ Create New Join Token</strong></em>.</p><p><img src="'+l+'" alt=""></p></li><li><p>Specify <code>lab-token</code> as the <em><strong>Name</strong></em> and click <em><strong>Confirm</strong></em>.</p><p><img src="'+p+'" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>Join Tokens are a type of Kubernetes Secret that can be created declaratively. See <a href="https://docs.kasten.io/latest/multicluster/tutorials/getting_started.html#join-tokens" target="_blank" rel="noreferrer">docs.kasten.io</a> for examples.</p><p>A single token can be used for multiple clusters. Deleting tokens has no impact on clusters that have already joined multi-cluster, but will prevent additional clusters from joining using the deleted token.</p></div></li><li><p>Click <em><strong>Copy</strong></em> to copy the token value to the clipboard and send the value to your <code>cluster-2</code> partner via one of the following:</p><ul><li>Slack</li><li>Slowly reading it aloud üò°</li><li>Carrier pigeon ü™∂</li><li>Writing it down on a Post-It and burning it after use ü§∑‚Äç‚ôÇÔ∏è</li><li>Probably stick with Slack üëç</li></ul></li><li><p>Click <em><strong>Done</strong></em>.</p></li></ol><h2 id="_4-joining-multi-cluster-from-secondary" tabindex="-1">4. Joining Multi-Cluster from Secondary <a class="header-anchor" href="#_4-joining-multi-cluster-from-secondary" aria-label="Permalink to &quot;4. Joining Multi-Cluster from Secondary&quot;">‚Äã</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p>This section should be completed by the <code>cluster-2</code> user <em><strong>ONLY</strong></em>.</p></div><ol><li><p>In the <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Multi-Cluster</strong></em> from the sidebar.</p></li><li><p>Under <em><strong>Join a Multi-Cluster System</strong></em>, click <em><strong>Join</strong></em>.</p><p><img src="'+c+'" alt=""></p></li><li><p>Paste the <code>lab-token</code> value from the primary cluster into the <em><strong>Token</strong></em> field.</p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>The join token also encodes the Kasten ingress URL required for a secondary to reach the primary cluster. If an alternate URL is required in a production environment, this value can be overridden as seen in the UI.</p></div></li><li><p>Specify <code>cluster-2</code> as the <em><strong>Local Cluster Name</strong></em> and click <em><strong>Use Current</strong></em> to populate <em><strong>Local Cluster Ingress</strong></em> with the current Kasten Route value.</p><p><img src="'+d+'" alt=""></p></li><li><p>Click <em><strong>Connect ‚Üí Yes</strong></em> to join <code>cluster-2</code>.</p><p>After a few moments you should observe the Multi-Cluster status page indicating the cluster has been connected to <code>cluster-1</code> as a primary.</p><p><img src="'+h+'" alt=""></p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><p>Joining secondary clusters can also be automated as part of a GitOps-style deployment by creating a <code>mc-join</code> Secret and <code>mc-join-config</code> ConfigMap on the secondary cluster to provide the join token and name/ingress details. See <a href="https://docs.kasten.io/latest/multicluster/tutorials/getting_started.html#adding-a-secondary-cluster" target="_blank" rel="noreferrer">docs.kasten.io</a> for details.</p></div></li></ol><h2 id="_5-managing-global-resources" tabindex="-1">5. Managing Global Resources <a class="header-anchor" href="#_5-managing-global-resources" aria-label="Permalink to &quot;5. Managing Global Resources&quot;">‚Äã</a></h2><div class="important custom-block github-alert"><p class="custom-block-title">IMPORTANT</p><p></p><p>This section should be completed by the <code>cluster-1</code> user <em><strong>ONLY</strong></em>.</p></div><ol><li><p>In the <code>cluster-1</code> <em><strong>Kasten Dashboard</strong></em>, select <em><strong>Multi-Cluster Manager</strong></em> from the dropdown menu and validate the <em><strong>Clusters</strong></em> page now displays both clusters.</p><p><img src="'+g+'" alt=""></p></li><li><p>Click the <em><strong>Grant Permissions</strong></em> button to configure permissions for the current <em><strong>Kasten Dashboard</strong></em> user.</p><p>This will pre-fill a form to extend the <code>k10-multi-cluster-admin</code> ClusterRole to the current user for all current and future Kasten clusters.</p><p><img src="'+u+'" alt=""></p><div class="note custom-block github-alert"><p class="custom-block-title">NOTE</p><p></p><p>In a production environment this can be modified...</p></div></li><li><p>Keep the default settings and click <em><strong>Save</strong></em>.</p></li><li><p>Select <em><strong>Clusters</strong></em> from the sidebar and click into <code>cluster-2</code> to validate it is accessible. The sidebar dropdown menu can be used to browse between available clusters and the <em><strong>Multi-Cluster Manager</strong></em>.</p><p><img src="'+m+`" alt=""></p></li><li><p>In the <em><strong>Web Terminal</strong></em>, run the following to fetch your existing Ceph Object Gateway bucket details:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CEPH_S3_ENDPOINT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;https://$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get route </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  s3-route </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openshift-storage </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.spec.host}&#39;)&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AWS_ACCESS_KEY_ID</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rook-ceph-object-user-ocs-storagecluster-cephobjectstore-ocs-storagecluster-cephobjectstoreuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openshift-storage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.data.AccessKey}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AWS_SECRET_ACCESS_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rook-ceph-object-user-ocs-storagecluster-cephobjectstore-ocs-storagecluster-cephobjectstoreuser</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  -n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openshift-storage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jsonpath=&#39;{.data.SecretKey}&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> base64</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --decode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">printf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;%s\\n&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ACCESS KEY:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${AWS_ACCESS_KEY_ID} </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;SECRET KEY:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${AWS_SECRET_ACCESS_KEY} </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ENDPOINT:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \${CEPH_S3_ENDPOINT}</span></span></code></pre></div></li><li><p>In <em><strong>Kasten Multi-Cluster Manager</strong></em>, select <em><strong>Global Profiles ‚Üí Location</strong></em> from the sidebar and click <em><strong>+ New Profile</strong></em></p><p><img src="`+k+'" alt=""></p></li><li><p>Fill out the following fields and click <em><strong>Save</strong></em>:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><em><strong>Profile Name</strong></em></td><td><code>global-profile-example</code></td></tr><tr><td><em><strong>Storage Provider</strong></em></td><td>S3 Compatible</td></tr><tr><td><em><strong>S3 Access Key</strong></em></td><td>Paste <code>ACCESS KEY</code> value</td></tr><tr><td><em><strong>S3 Secret</strong></em></td><td>Paste <code>SECRET KEY</code> value</td></tr><tr><td><em><strong>Endpoint</strong></em></td><td>Paste <code>ENDPOINT</code> value</td></tr><tr><td><em><strong>Region</strong></em></td><td><code>us-east-1</code></td></tr><tr><td><em><strong>Bucket</strong></em></td><td><code>kasten</code></td></tr></tbody></table><p><img src="'+b+'" alt=""></p></li><li><p>Select <em><strong>Distributions</strong></em> from the sidebar and click <em><strong>+ New Distribution</strong></em>.</p><p>Distributions define which global resources should be synced with which clusters, allowing administrators to define label-based rules to automate resource distribution for new Kasten installs joining multi-cluster.</p></li><li><p>Fill out the following fields:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><em><strong>Name</strong></em></td><td><code>example-distribution</code></td></tr><tr><td><em><strong>Clusters</strong></em></td><td>Select <code>dist.kio.kasten.io/cluster-type:primary</code></td></tr><tr><td></td><td>Select <code>dist.kio.kasten.io/cluster-type:secondary</code></td></tr><tr><td><em><strong>Resources</strong></em></td><td>Select <code>global-profile-example</code></td></tr></tbody></table><p><img src="'+y+'" alt=""></p><p>This configuration will ensure the <code>global-profile-example</code> Location Profile is synced to all current and future Kasten clusters.</p></li><li><p>Click <em><strong>Add Distribution</strong></em>.</p><p>You should observe that the distribution has been synced to the selected clusters.</p><p><img src="'+C+'" alt=""></p><div class="tip custom-block github-alert"><p class="custom-block-title">TIP</p><p></p><p>You can view a summary of global resources for each cluster from the <em><strong>Multi-Cluster</strong></em> status page as shown below.</p><p><img src="'+F+'" alt=""></p></div></li></ol><h2 id="_6-takeaways" tabindex="-1">6. Takeaways <a class="header-anchor" href="#_6-takeaways" aria-label="Permalink to &quot;6. Takeaways&quot;">‚Äã</a></h2><ul><li>Kasten Multi-Cluster Manager provides an interface for administrators to manage many Kasten deployments from a single interface</li><li>Kasten policies and profiles can be centrally defined to simplify change management and ensure consistency across large environments</li></ul>',20),_=[E];function v(S,B,T,w,P,A){return t(),s("div",null,_)}const I=e(f,[["render",v]]);export{D as __pageData,I as default};
